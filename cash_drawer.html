<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>CafeTrack - Cash Drawer</title>
<style>
  * { box-sizing: border-box; font-family: "Poppins", sans-serif; margin:0; padding:0; }
  body { background-color: #fdfaf6; color: #3e2723; }

  /* Navbar */
  .navbar { background-color: #5d4037; color: #fff; padding: 15px 30px; display:flex; justify-content:center; align-items:center; box-shadow:0 2px 8px rgba(0,0,0,0.2); }
  .navbar h1 { font-size:24px; letter-spacing:1px; }

  /* Container */
  .cashdrawer-container { max-width: 850px; margin: 50px auto; background:#fff; border-radius:10px; box-shadow:0 3px 10px rgba(0,0,0,0.1); padding:40px; }
  .cashdrawer-container h1 { text-align:center; color:#4e342e; margin-bottom:25px; }

  .cashdrawer-form { display:flex; flex-direction:column; gap:20px; }

  /* Form Row */
  .form-row { display:flex; justify-content:space-between; align-items:center; gap:15px; }
  .form-row label { flex:1; font-weight:600; color:#5d4037; }
  .form-row input { flex:2; padding:10px; border:1px solid #ccc; border-radius:8px; outline:none; transition:0.3s; }
  .form-row input:focus { border-color:#8d6e63; box-shadow:0 0 4px #d7ccc8; }

  /* Expenses Card */
  .expenses-card { background:#f7f1ec; padding:20px; border-radius:10px; }
  .expenses-card h3 { color:#4e342e; margin-bottom:15px; text-align:center; }
  .expenses-table { width:100%; border-collapse:collapse; }
  .expenses-table td { padding:10px; color:#3e2723; }
  .expenses-table input { width:100%; padding:8px; border:1px solid #bdbdbd; border-radius:6px; text-align:right; }

  .expense-actions { text-align:right; margin-top:10px; }
  .expense-actions button { padding:5px 10px; border:none; border-radius:5px; background:#a1887f; color:#fff; cursor:pointer; transition:0.3s; margin-left:5px; }
  .expense-actions button:hover { background:#8d6e63; }

  /* Total Card */
  .summary-card { background:#efebe9; padding:15px; text-align:center; border-radius:8px; font-size:18px; font-weight:bold; color:#4e342e; margin-top:10px; }
  .summary-card span { display:block; margin-top:5px; }

  /* Actions */
  .cashdrawer-actions { display:flex; justify-content:space-between; gap:10px; margin-top:15px; }
  .cashdrawer-btn { flex:1; padding:12px; border:none; border-radius:8px; color:#fff; font-weight:bold; cursor:pointer; transition:0.3s; }
  .btn-open { background-color:#6d4c41; } .btn-open:hover { background-color:#5d4037; }
  .btn-close { background-color:#8d6e63; } .btn-close:hover { background-color:#6d4c41; }
  .btn-export { background-color:#a1887f; } .btn-export:hover { background-color:#8d6e63; }

  @media(max-width:600px) {
    .form-row { flex-direction:column; align-items:flex-start; }
    .form-row label, .form-row input { width:100%; }
    .cashdrawer-actions { flex-direction:column; }
  }
</style>
</head>
<body>

<div class="navbar"><h1>CafeTrack</h1></div>

<div class="cashdrawer-container">
  <h1>Cash Drawer</h1>
  <form class="cashdrawer-form" id="cashdrawerForm">
    <div class="form-row">
      <label for="date">Date:</label>
      <input type="date" id="date">
    </div>

    <div class="form-row">
      <label for="cashier">Cashier:</label>
      <input type="text" id="cashier" readonly>
    </div>

    <div class="form-row">
      <label for="opening">Opening Balance:</label>
      <input type="number" id="opening" value="0">
    </div>

    <div class="form-row">
      <label for="cashSale">Cash Sales:</label>
      <input type="number" id="cashSale" value="0">
    </div>

    <div class="form-row">
      <label for="cashless">Cashless Payments (GCash/Card):</label>
      <input type="number" id="cashless" value="0">
    </div>

    <div class="expenses-card">
      <h3>Store Expenses</h3>
      <table class="expenses-table" id="expensesTable">
        <tr><td>Description</td><td>Amount</td></tr>
        <tr>
          <td><input type="text" class="expense-desc" placeholder="Example: Milk refill"></td>
          <td><input type="number" class="expense" value="0"></td>
        </tr>
      </table>
      <div class="expense-actions">
        <button type="button" onclick="addExpense()">+ Add</button>
        <button type="button" onclick="removeExpense()">- Remove</button>
      </div>
    </div>

    <div class="form-row">
      <label for="actualCash">Actual Cash in Drawer:</label>
      <input type="number" id="actualCash" value="0">
    </div>

    <div class="summary-card" id="summaryCard">
      <span>Expected Cash: â‚±0.00</span>
      <span>Over/Short: â‚±0.00</span>
    </div>

    <div class="cashdrawer-actions">
      <button type="button" class="cashdrawer-btn btn-open" onclick="openDrawer()">Open Drawer</button>
      <button type="button" class="cashdrawer-btn btn-close" onclick="closeDrawer()">Close Drawer</button>
      <button type="button" class="cashdrawer-btn btn-export" onclick="exportReport()">Export Report</button>
    </div>
  </form>
</div>

<script>
// Default date and cashier
document.getElementById('date').valueAsDate = new Date();
const loggedInCashier = localStorage.getItem("staffUsername") || "Unknown";
document.getElementById('cashier').value = loggedInCashier;

// Calculate expected and over/short
function calculateSummary() {
  const opening = +document.getElementById('opening').value || 0;
  const cashSale = +document.getElementById('cashSale').value || 0;
  const cashless = +document.getElementById('cashless').value || 0;
  const actual = +document.getElementById('actualCash').value || 0;
  const expenses = Array.from(document.querySelectorAll('.expense'))
                        .reduce((sum, e) => sum + (+e.value || 0), 0);

  const expectedCash = opening + cashSale - expenses;
  const overShort = actual - expectedCash;

  const summary = document.getElementById('summaryCard');
  summary.innerHTML = `
    <span>Expected Cash: â‚±${expectedCash.toFixed(2)}</span>
    <span style="color:${overShort < 0 ? 'red' : (overShort > 0 ? 'green' : '#4e342e')}">
      ${overShort === 0 ? 'Balanced' : overShort > 0 ? 'Over by â‚±' + overShort.toFixed(2) : 'Short by â‚±' + Math.abs(overShort).toFixed(2)}
    </span>
  `;
}

// Attach input listeners
document.querySelectorAll('#opening, #cashSale, #cashless, #actualCash').forEach(i => {
  i.addEventListener('input', calculateSummary);
});

function addExpense() {
  const table = document.getElementById('expensesTable');
  const row = table.insertRow();
  row.innerHTML = `
    <td><input type="text" class="expense-desc" placeholder="Description"></td>
    <td><input type="number" class="expense" value="0"></td>
  `;
  row.querySelector('.expense').addEventListener('input', calculateSummary);
}
function removeExpense() {
  const table = document.getElementById('expensesTable');
  if (table.rows.length > 2) table.deleteRow(-1);
  calculateSummary();
}

document.querySelector('.expense').addEventListener('input', calculateSummary);
calculateSummary();

function openDrawer() { alert("Cash drawer opened! ðŸŸ¢"); }
function closeDrawer() { alert("Cash drawer closed! ðŸ”’"); }

function exportReport() {
  const date = document.getElementById('date').value;
  const cashier = document.getElementById('cashier').value;
  const opening = document.getElementById('opening').value;
  const cashSale = document.getElementById('cashSale').value;
  const cashless = document.getElementById('cashless').value;
  const actual = document.getElementById('actualCash').value;

  let report = `CafeTrack Cash Drawer Report\n\nDate: ${date}\nCashier: ${cashier}\nOpening: â‚±${opening}\nCash Sales: â‚±${cashSale}\nCashless: â‚±${cashless}\n\nExpenses:\n`;
  document.querySelectorAll('#expensesTable tr').forEach((row, i) => {
    if (i === 0) return;
    const desc = row.querySelector('.expense-desc').value || '-';
    const amt = row.querySelector('.expense').value || 0;
    report += `${desc}: â‚±${amt}\n`;
  });
  report += `\nActual Cash: â‚±${actual}\n${document.getElementById('summaryCard').innerText}`;
  alert("Report exported!\n\n" + report);
}
</script>

</body>
</html>
